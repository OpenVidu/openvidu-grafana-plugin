
FROM node:18-alpine

WORKDIR /opt/rtsp-application

COPY . .

# Set environment variables
ENV SERVER_PORT=$SERVER_PORT
ENV OPENVIDU_URL=$OPENVIDU_URL
ENV OPENVIDU_SECRET=$OPENVIDU_SECRET
ENV SESSION_NAME=$SESSION_NAME
ENV RTSP_CAMERAS_URLS=$RTSP_CAMERAS_URLS
ENV RTSP_CAMERA_USERNAME=$RTSP_CAMERA_USERNAME
ENV RTSP_CAMERA_PASSWORD=$RTSP_CAMERA_PASSWORD
ENV RTSP_MODE=$RTSP_MODE
ENV RECORDING_DURATION_SECONDS=$RECORDING_DURATION_SECONDS
ENV DATA_GENERATION_STATUS=$DATA_GENERATION_STATUS
ENV DATA_GENERATION_INTERVAL_SECONDS=$DATA_GENERATION_INTERVAL_SECONDS
ENV DB_HOSTNAME=$DB_HOSTNAME
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV DB_NAME=$DB_NAME
ENV DB_VIDEO_TABLE=$DB_VIDEO_TABLE
ENV DB_METRIC_TABLE=$DB_METRIC_TABLE

RUN npm install --location=global npm

# Build RTSP Application
RUN npm install && \
    npm run build


CMD ["node", "dist/app.js"]